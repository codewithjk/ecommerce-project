<%- include("./layouts/header") %>

  <div id="layout-wrapper">
    <%- include("./layouts/topbar") %>
      <!-- ========== App Menu ========== -->
      <%-include("./layouts/menubar") %>
        <!-- Left Sidebar End -->

        <div class="main-content">
          <div class="page-content">
            <div class="container-fluid">
              <!-- start page title -->
              <div class="row">
                <div class="col-12">
                  <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                    <h4 class="mb-sm-0">offers</h4>

                    <div class="page-title-right">
                      <ol class="breadcrumb m-0">
                        <li class="breadcrumb-item">
                          <a href="/admin/dashboard">dashboard</a>
                        </li>
                        <li class="breadcrumb-item active">offers</li>
                      </ol>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end page title -->
              <div id="offersList">
                <div class="row">
                  <div class="col-xxl-12">
                    <div class="card">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col-xxl-3 col-md-5">
                            <div class="search-box mb-3 mb-md-0"></div>
                          </div>
                          <!--end col-->
                          <div class="col-md-auto ms-auto">
                            <button data-bs-target="#addModal" data-bs-toggle="modal" class="btn btn-success add-btn">
                              <i class="bi bi-plus-circle me-1 align-middle"></i>Add
                              offer
                            </button>
                          </div>
                          <!--end col-->
                        </div>
                        <!--end row-->
                      </div>
                    </div>
                    <!--end card-->
                  </div>
                  <!--end col-->
                </div>
                <!--end row-->

                <div class="row">
                  <div class="col-lg-12">
                    <div class="card">
                      <div class="card-body">
                        <div class="table-responsive table-card">
                          <table class="table align-middle table-nowrap" id="offerTable">
                            <thead class="table-light">
                              <tr>
                                <th scope="col">Discount</th>
                                <th scope="col">offer Title</th>

                                <th scope="col">Start Date</th>
                                <th scope="col">End Date</th>

                                <th scope="col">Action</th>
                              </tr>
                            </thead>
                            <tbody class="list">
                              <% offers.forEach(offer=> {%>
                                <tr>
                                  <td class="discount">
                                    <h5 class="mb-0 fs-16">
                                      <%=offer.discount %> %
                                    </h5>
                                  </td>
                                  <td class="offerTitle">
                                    <%=offer.title %>
                                  </td>

                                  <td class="startDate">
                                    <%=offer.startDate.toLocaleString('en-US', { weekday: 'short' , year: 'numeric' ,
                                      month: 'short' , day: 'numeric' , hour: '2-digit' , minute: '2-digit' ,
                                      second: '2-digit' }) %>
                                  </td>
                                  <td class="endDate">
                                    <%=offer.endDate.toLocaleString('en-US', { weekday: 'short' , year: 'numeric' ,
                                      month: 'short' , day: 'numeric' , hour: '2-digit' , minute: '2-digit' ,
                                      second: '2-digit' }) %>
                                  </td>

                                  <td>
                                    <% const offerObj=JSON.stringify(offer) %>
                                      <ul class="hstack gap-2 list-unstyled mb-0">
                                        <li>
                                          <a href="#offerDetails" data-bs-toggle="offcanvas"
                                            data-custom-data="<%=offerObj %>"
                                            class="badge bg-dark-subtle text-dark view-item-btn">View</a>
                                        </li>

                                        <li>
                                          <a href="#deleteOfferModal" data-bs-toggle="modal"
                                            data-custom-data="<%=offer._id %>"
                                            class="badge bg-danger-subtle text-danger remove-item-btn">Delete</a>
                                        </li>
                                      </ul>
                                  </td>
                                </tr>
                                <% }); %>
                            </tbody>
                          </table>
                          <div class="noresult" style="display: none">
                            <div class="text-center">
                              <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop"
                                colors="primary:#121331,secondary:#08a88a"
                                style="width: 75px; height: 75px"></lord-icon>
                              <h5 class="mt-2">Sorry! No Result Found</h5>
                              <p class="text-muted mb-0">
                                We've searched more than 150+ Orders We did not find
                                any orders for you search.
                              </p>
                            </div>
                          </div>
                        </div>
                        <div class="d-flex justify-content-end mt-3"></div>
                      </div>
                      <!--end card-body-->
                    </div>
                    <!--end card-->
                  </div>
                  <!--end col-->
                </div>
                <!--end row-->
              </div>
            </div>
            <!-- container-fluid -->
          </div>
          <!-- End Page-content -->

          <footer class="footer">
            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-6">
                  <script>
                    document.write(new Date().getFullYear());
                  </script>
                  Â© FASCO.
                </div>
                <div class="col-sm-6">
                  <div class="text-sm-end d-none d-sm-block"></div>
                </div>
              </div>
            </div>
          </footer>
        </div>
  </div>
  <!-- END layout-wrapper -->

  <!-- offer details -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offerDetails" aria-labelledby="offerDetailsLabel">
    <div class="offcanvas-header bg-warning-subtle">
      <h5 class="offcanvas-title" id="offerDetails">Winter Gift Voucher</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div>
        <!-- <img
        id="img-thumbnail"
        src="../assets/images/ecommerce/offer-banner.jpg"
        alt=""
        class="img-thumbnail"
      /> -->
      </div>
      <div class="mt-3">
        <div class="table-responsive">
          <table class="table table-borderless">
            <tbody>
              <tr>
                <td><span class="text-muted">Title</span></td>
                <td><span class="fw-medium" id="ctitle"></span></td>
              </tr>
              <tr>
                <td><span class="text-muted">Discount</span></td>
                <td>
                  <span class="fw-medium text-uppercase" id="cdiscount"></span>
                </td>
              </tr>
              <tr>
                <td><span class="text-muted">Start Date</span></td>
                <td><span class="fw-medium" id="cstartDate"></span></td>
              </tr>
              <tr>
                <td><span class="text-muted">END Date</span></td>
                <td><span class="fw-medium" id="cendDate"></span></td>
              </tr>

              <!-- <tr>
              <td><span class="text-muted">category</span></td>
              <td><span class="fw-medium" id="ccategory"></span></td>
            </tr> -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- delete modal -->
  <div id="deleteOfferModal" class="modal fade zoomIn" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-md-5">
          <div class="text-center">
            <div class="text-danger">
              <i class="bi bi-trash display-4"></i>
            </div>
            <div class="mt-4 fs-15">
              <h4 class="mb-1">Are you sure ?</h4>
              <p class="text-muted mx-4 mb-0">
                Are you sure you want to remove this offers ?
              </p>
            </div>
          </div>
          <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
            <button type="button" class="btn w-sm btn-light btn-hover" id="deleteRecord-close" data-bs-dismiss="modal">
              Close
            </button>
            <button type="button" class="btn w-sm btn-danger btn-hover" id="remove-offer">
              Yes, Delete It!
            </button>
          </div>
          <p id="yes-delete" class="text-success"></p>
          <p id="no-delete" class="text-danger"></p>
        </div>
      </div>
      <!--end modal-content -->
    </div>
    <!--end modal-dialog -->
  </div>
  <!-- add offer modal -->
  <div id="addModal" class="modal fade zoomIn" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content border-0">
        <div class="modal-header px-4 pt-4">
          <h5 class="modal-title fs-18" id="exampleModalLabel">Add offers</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
        </div>
        <div class="modal-body p-4">
          <form class="addOffer-form" novalidate autocomplete="off">
            <div class="row">
              <div id="alert-error-msg" class="d-none alert alert-danger py-2"></div>
              <input type="hidden" id="id-field" />
              <div class="col-lg-12">
                <div class="mb-3">
                  <label for="offerTitle" class="form-label">offer Title</label>
                  <input type="text" class="form-control" id="offerTitle-field" placeholder="offer title" required
                    oninput="removeError('titleError')" />
                  <p id="titleError" class="text-danger"></p>
                </div>
              </div>
              <div>
                <select class="form-select" id="category-field" name="choices-category-input">
                  <% categories.forEach(category=> { %>
                    <option value="<%=category._id  %>">
                      <%=category.title %>
                    </option>

                    <% }); %>
                </select>
              </div>

              <div class="col-lg-6">
                <div class="mb-3">
                  <label for="startDate" class="form-label">Start Date</label>
                  <input type="datetime-local" class="form-control" id="startdate-field" data-provider="flatpickr"
                    placeholder="Select date" required />
                  <p id="dateError" class="text-danger"></p>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="mb-3">
                  <label for="endDate" class="form-label">END Date</label>
                  <input type="datetime-local" class="form-control" id="enddate-field" data-provider="flatpickr"
                    data-date-format="d M, Y" placeholder="Select date" required />
                </div>
              </div>
              <div class="col-lg-6">
                <div class="mb-3">
                  <label for="amountPercentage" class="form-label">Amount/Percentage</label>
                  <input type="number" class="form-control" id="discount-field" placeholder="Enter percentage" required
                    oninput="removeError('priceError')" />
                  <p id="priceError" class="text-danger"></p>
                </div>
              </div>

              <div class="col-lg-12 modal-footer">
                <p class="formError text-danger"></p>
                <p class="formSuccess text-success"></p>
                <div class="hstack gap-2 justify-content-end">
                  <button type="button" class="btn btn-ghost-danger" data-bs-dismiss="modal">
                    <i class="ri-close-line align-bottom me-1"></i> Close
                  </button>
                  <button type="submit" class="btn btn-primary" id="add-btn">
                    Add Offer
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
  <!--preloader-->
  <div id="preloader">
    <div id="status">
      <div class="spinner-border text-primary avatar-sm" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>

  <%- include("./layouts/footer") %>
    <script src="https://cdn.datatables.net/2.0.2/js/dataTables.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var table = document.getElementById("offerTable");

        var dataTable = new DataTable(table, {
          layout: {
            topStart: {},
          },
        });
      });
    </script>
    <script src="/script/admin/offerPage.js"></script>